.include "common.inc"

    # Configure lower 8 pins as output, bit 8 as input
    LUI  x5, GPIO_BASE_HI
    ADDI x5, x5, GPIO_BASE_LO
    ADDI x6, x0, 0x00FF
    SW   x6, GPIO_DIR(x5)

    # Enable interrupt for bit 8
    ADDI x7, x0, 0x100
    SW   x7, GPIO_IRQ_EN(x5)

wait_irq:
    LW   x8, GPIO_IRQ_STATUS(x5)
    AND  x9, x8, x7
    BEQ  x9, x0, wait_irq

    # Store IRQ status to DMEM[1]
    SW   x8, 4(x0)
    SW   x7, GPIO_IRQ_STATUS(x5)
    JAL  x0, wait_irq
